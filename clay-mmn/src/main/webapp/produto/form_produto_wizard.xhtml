<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">
	
	
	<script type = "text/javascript">
			function mascara(o, f) {
				v_obj = o;
				v_fun = f;
				setTimeout(“execmascara()”, 1);
			}
			
			function execmascara() {
				v_obj.value = v_fun(v_obj.value);
			}
			
			function valor(v) {
				v = v.replace(/\D/g, “”);
				v = v.replace(/[0-9]{15}/, “invÃ¡lido”);
				v = v.replace(/(\d{1})(\d{11})$/, “$1.$2”); // coloca ponto antes dos
				// Ãºltimos 11 digitos
				v = v.replace(/(\d{1})(\d{8})$/, “$1.$2”); // coloca ponto antes dos
				// Ãºltimos 8 digitos
				v = v.replace(/(\d{1})(\d{5})$/, “$1.$2”); // coloca ponto antes dos
				// Ãºltimos 5 digitos
				v = v.replace(/(\d{1})(\d{1,2})$/, “$1,$2”); // coloca virgula antes dos
				// Ãºltimos 2 digitos
				return v;
			}

</script>
	

	<div>
		<h3>
			<h:outputText value="#{msg['label.produto']}" />
			<small> <h:outputText value="#{subtitle}" /></small>
		</h3>
	</div>
	
	<h:form styleClass="form-horizontal">
		
		<p:wizard nextLabel="Avançar" backLabel="Voltar" flowListener="#{produtoMB.tratarAbas}">
			<p:tab id="dadosProduto" title="Dados">
				<fieldset>
					<legend>
						<small> <h:outputText value="Dados Básicos" /></small>
					</legend>

					<div class="control-group">
						<label class="control-label">
							<h:outputText value="#{msg['label.produto.nome']} *" />
						</label>
						<div class="controls">
							<p:inputText value="#{produtoMB.produto.nomeProduto}" label="#{msg['label.produto.nome']}" required="true" styleClass="input-large">
								<f:validateLength minimum="5" maximum="100" />
							</p:inputText>
						</div>
					</div>
		
					<div class="control-group">
						<label class="control-label">
							<h:outputText value="#{msg['label.produto.dsproduto']}"  />
						</label>
						<div class="controls">
							<p:inputText value="#{produtoMB.produto.descProduto}" label="#{msg['label.produto.dsproduto']}"  styleClass="input-large"/>
								
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">
							<h:outputText value="#{msg['label.produto.percmargemvenda']} " />
						</label>
						<div class="controls">
							<p:inputText value="#{produtoMB.produto.percMargemVenda}" label="#{msg['label.produto.percmargemvenda']}" styleClass="input-large"/>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">
							<h:outputText value="#{msg['label.produto.kit']}" />
						</label>
						<div class="controls">
                    		<p:selectBooleanCheckbox value="#{produtoMB.kit}" />
                    	</div>
                    </div>
				</fieldset>
				
				<fieldset>
					<legend>
						<small> <h:outputText value="Dimensões" /></small>
					</legend>
					<div class="control-group">
						<label class="control-label">
							<h:outputText value="#{msg['label.produto.qtdaltura']}" />
						</label>
						<div class="controls">
					        <p:inputMask value="#{produtoMB.produto.qtdAltura}"  label="#{msg['label.produto.qtdaltura']}" styleClass="input-small" />
						</div>
					</div>
					
					<div class="control-group">
						<label class="control-label">
							<h:outputText value="#{msg['label.produto.qtdlargura']}" />
						</label>
						<div class="controls">
					        <p:inputMask value="#{produtoMB.produto.qtdLargura}"  label="#{msg['label.produto.qtdlargura']}" styleClass="input-small" />
						</div>
					</div>
					
					<div class="control-group">
						<label class="control-label">
							<h:outputText value="#{msg['label.produto.qtdpeso']}" />
						</label>
						<div class="controls">
					        <p:inputMask value="#{produtoMB.produto.qtdPeso}"  label="#{msg['label.produto.qtdpeso']}" styleClass="input-small" />
						</div>
					</div>
				</fieldset>
			</p:tab>
			
			<p:tab id="tabVenda" title="Venda">
				<fieldset>
					<legend>
						<small> <h:outputText value="#{msg['label.fornecedor']}" /></small>
					</legend>
					<div class="control-group">
						<label class="control-label">
							<h:outputText value="#{msg['label.fornecedor']} *" />
						</label>
						<div class="controls">
							<p:selectOneMenu id="dropFornecedor" value="#{produtoMB.produto.fornecedor}" converter="entityConverter" filter="true" filterMatchMode="startsWith" required="true" label="#{msg['label.fornecedor']}">
				                <f:selectItem itemLabel="Selecione..." itemValue="" noSelectionOption="true" />
				                <f:selectItems value="#{produtoMB.listaFornecedor}" var="fornecedor" itemLabel="#{fornecedor.nomePessoa}" itemValue="#{fornecedor}"/>
			    	        </p:selectOneMenu>
						</div>
					</div>
					
					<legend>
						<small> <h:outputText value="#{msg['label.categoria']}" /></small>
					</legend>
					<div class="control-group">
						<label class="control-label">
							<h:outputText value="#{msg['label.categoria']} *" />
						</label>
						<div class="controls">
							<p:selectOneMenu id="dropCategoria" value="#{produtoMB.produto.categoria}" converter="entityConverter" filter="true" filterMatchMode="startsWith" required="true" label="#{msg['label.categoria']}">
				                <f:selectItem itemLabel="Selecione..." itemValue="" noSelectionOption="true" />
				                <f:selectItems value="#{produtoMB.listaCategoria}" var="categoria" itemLabel="#{categoria.descCategoria}"/>
			    	        </p:selectOneMenu>
						</div>
					</div>
					
					<legend>
						<small> <h:outputText value="#{msg['label.produto.unidadevenda']}" /></small>
					</legend>
					<div class="control-group">
						<label class="control-label">
							<h:outputText value="#{msg['label.produto.unidadevenda']} *" />
						</label>
						<div class="controls">
							<p:selectOneMenu id="dropUnidadeVenda" value="#{produtoMB.produto.unidadeVenda}" converter="entityConverter" filter="true" filterMatchMode="startsWith" required="true" label="#{msg['label.produto.unidadevenda']}">
				                <f:selectItem itemLabel="Selecione..." itemValue="" noSelectionOption="true" />
				                <f:selectItems value="#{produtoMB.listaUnidadeVenda}" var="unidadeVenda" itemLabel="#{unidadeVenda.descUnidadeVenda}" itemValue="#{unidadeVenda}"/>
			    	        </p:selectOneMenu>
						</div>
					</div>
				</fieldset>
			</p:tab>
					
			<p:tab id="tabKit" title="#{msg['label.produto.kit']}">
				<fieldset>
					<legend>
						<small> <h:outputText value="#{msg['label.produto.kit']}" /></small>
					</legend>
					<h:form>
						<p:dataTable id="dtProdutosSelecionados" value="#{produtoMB.listaProdutoComposicaoFilho}" 
							var="produtoComposicao" selection="#{produtoMB.listaProdutosSelecionadosKit}" rowKey="#{produtoComposicao.id}"
							emptyMessage="#{msg['alerta.nenhum.produto.selecionado']}">
							<p:column selectionMode="multiple" style="width:16px;text-align:center"/>
						    <p:column headerText="#{msg['label.produto.produtosSelecionados']}">
						        <h:outputText value="#{produtoComposicao.produtoFilho.id} - #{produtoComposicao.produtoFilho.nomeProduto} - #{produtoComposicao.produtoFilho.descProduto} - #{produtoComposicao.qtdProdutoComposicao}" style="display:inline-block"/>
						    </p:column>
						    <p:column style="width:32px;text-align: center">
					             <p:commandButton update=":form:detalheProduto" oncomplete="PF('detalheProdutoDialog').show()" icon="ui-icon-search" title="#{msg['button.detalhar']}">
					                <f:setPropertyActionListener value="#{produtoComposicao}" target="#{produtoMB.produtoComposicaoSelecionado}" />
					            </p:commandButton>
					        </p:column>
						    <f:facet name="footer">
						        <p:commandButton process="dtProdutosSelecionados" icon="ui-icon-circle-plus" value="#{msg['button.incluir']}" oncomplete="PF('selecionarProdutoDialog').show()" />
						        <p:commandButton icon="ui-icon-circle-close" value="#{msg['button.excluir']}" oncomplete="PF('confirmaExcluirProdutos').show()" />
						    </f:facet>
						</p:dataTable>
					    
						<p:dialog header="#{msg['page.title.detalhe.produto']}" widgetVar="detalheProdutoDialog" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
					        <p:outputPanel id="detalheProduto" style="text-align:center;">
					            
					        </p:outputPanel>
					    </p:dialog>
					    <p:dialog widgetVar="selecionarProdutoDialog" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
					        <p:outputPanel id="painelSelecionarProdutos" style="text-align:center;">
								<ui:include src="selecionar_produto.xhtml"/>
					        </p:outputPanel>
					    </p:dialog>
					    <p:confirmDialog header="#{msg['excluir.produtos.selecionados']}" widgetVar="confirmaExcluirProdutos" message="#{msg['excluir.produtos.selecionados.confirma']}" severity="alert">  
					        <p:commandButton value="#{msg['confirma.sim']}" oncomplete="PF('confirmaExcluirProdutos').hide()" />  
					        <p:commandButton value="#{msg['confirma.nao']}" onclick="PF('confirmaExcluirProdutos').hide()" type="button" />
					    </p:confirmDialog>
					</h:form>
				</fieldset>
				
			</p:tab>
			
			<p:tab id="tabValor" title="Valor">
				<fieldset>
					<legend>
						<small> <h:outputText value="#{msg['label.produto.produtovalor']} *" /></small>
					</legend>
					<div class="control-group">
						<label class="control-label">
							<h:outputText value="#{msg['label.produto.produtovalor.vlcusto']}" />
						</label>
						<div class="controls">
							<p:inputText maxlength="15" required="true" value="#{produtoMB.produtoValor.valorCusto}"  label="#{msg['label.produto.produtovalor.vlcusto']}"  immediate="true" styleClass="input-large"  onkeypress="mascara(this, valor);"/>
						</div>
					</div>
					
					<div class="control-group">
						<label class="control-label">
							<h:outputText value="#{msg['label.produto.produtovalor.vldesconto']}" />
						</label>
						<div class="controls">
					        <p:inputText value="#{produtoMB.produtoValor.valorDesconto}" label="#{msg['label.produto.produtovalor.vldesconto']}"  styleClass="input-large">
					       
					        </p:inputText>
						</div>
					</div>
					
					<div class="control-group">
						<label class="control-label">
							<h:outputText value="#{msg['label.produto.produtovalor.vlproduto']} *" />
						</label>
						<div class="controls">
					        <p:inputText value="#{produtoMB.produtoValor.valorProduto}" label="#{msg['label.produto.produtovalor.vlproduto']}" required="true" immediate="true" styleClass="input-large"/>
						</div>
					</div>
				</fieldset>
			</p:tab>
			
			<p:tab id="tabConfirmacao" title="Confirmação">
				<fieldset>
					<legend>
						<small> <h:outputText value="Informações de Cadastro" /></small>
					</legend>
					
					<h:panelGrid id="pnlConfirmacao" columns="3" columnClasses="grid,grid,grid">
						<h:panelGrid columns="2" columnClasses="label,value" border="1">
							<h:outputText value="#{msg['label.produto.nome']}" />
							<h:outputText value="#{produtoMB.produto.nomeProduto}" styleClass="outputLabel"/>
							
							<h:outputText value="#{msg['label.produto.dsproduto']}" />
							<h:outputText value="#{produtoMB.produto.descProduto}" styleClass="outputLabel"/>
							
							<h:outputText value="#{msg['label.produto.percmargemvenda']}" />
							<h:outputText value="#{produtoMB.produto.percMargemVenda}" styleClass="outputLabel"/>
							
							<h:outputText value="#{msg['label.produto.qtdaltura']}" />
							<h:outputText value="#{produtoMB.produto.qtdAltura}" styleClass="outputLabel"/>

							<h:outputText value="#{msg['label.produto.qtdlargura']}" />
							<h:outputText value="#{produtoMB.produto.qtdLargura}" styleClass="outputLabel"/>
							
							<h:outputText value="#{msg['label.produto.qtdpeso']}" />
							<h:outputText value="#{produtoMB.produto.qtdPeso}" styleClass="outputLabel"/>		
						</h:panelGrid>
						
						
						<h:panelGrid columns="2" columnClasses="label,value" border="1">
							<h:outputText value="#{msg['label.categoria']}" />
							<h:outputText value="#{produtoMB.produto.categoria.descCategoria}" styleClass="outputLabel"/>
							
							<h:outputText value="#{msg['label.fornecedor']}" />
							<h:outputText value="#{produtoMB.produto.fornecedor.nomePessoa}" styleClass="outputLabel"/>
							
							<h:outputText value="#{msg['label.produto.unidadevenda']}" />
							<h:outputText value="#{produtoMB.produto.unidadeVenda.descUnidadeVenda}" styleClass="outputLabel"/>
						</h:panelGrid>
						
						<h:panelGrid columns="2" columnClasses="label,value" border="1">
							<h:outputText value="#{msg['label.produto.produtovalor.vlcusto']}" />
							<h:outputText value="#{produtoMB.produto.listaProdutoValor.get(0).valorCusto}" styleClass="outputLabel"/>
							
							<h:outputText value="#{msg['label.produto.produtovalor.vldesconto']}" />
							<h:outputText value="#{produtoMB.produto.listaProdutoValor.get(0).valorDesconto}" styleClass="outputLabel"/>
							
							<h:outputText value="#{msg['label.produto.produtovalor.vlproduto']}" />
							<h:outputText value="#{produtoMB.produto.listaProdutoValor.get(0).valorProduto}" styleClass="outputLabel"/>
						</h:panelGrid>
					</h:panelGrid>
				</fieldset>
					
				<p:separator/>
		
				<div class="controls">
					<p:commandButton value="#{msg['button.salvar']}" action="#{produtoMB.salvar}" styleClass="btn btn-success" onclick="PF('dlg').show();" 
						oncomplete="PF('dlg').hide();" rendered="#{produtoMB.produto != null}" />
					
					<p:button value="#{msg['button.cancelar']}" outcome="lista_produto" styleClass="btn" />
					
					<p:commandButton value="#{msg['button.excluir']}" onclick="PF('confirmation').show();" rendered="#{produtoMB.produto.id != null}" immediate="true" styleClass="btn btn-danger" />
				</div>
				
			</p:tab>
		</p:wizard>
		
		<p:dialog id="dialog" header="#{msg['dialog.emexecucao.titulo']}" widgetVar="dlg" dynamic="true" modal="true">  
	    	<h:outputText value="#{msg['dialog.emexecucao.aguarde']}" />  
		</p:dialog>
		
		<p:confirmDialog id="confirmDialog" message="#{msg['excluir.produto.confirma']}" header="#{msg['excluir.produto']}" severity="alert" widgetVar="confirmation">  
	        <p:commandButton id="confirm" value="#{msg['confirma.sim']}" update="messages" oncomplete="PF('confirmation').hide()" action="#{produtoMB.remover}" />  
	        <p:commandButton id="decline" value="#{msg['confirma.nao']}" update="messages" onclick="PF('confirmation').hide()" type="button" />
	    </p:confirmDialog>
	    
	    <p:messages id="messages" showDetail="false" autoUpdate="true" closable="true" />
		<h:inputHidden value="#{produtoMB.produto.id}" />
	</h:form>
</ui:fragment>
